{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.MongoCR = void 0;\nconst crypto = require(\"crypto\");\nconst error_1 = require(\"../../error\");\nconst utils_1 = require(\"../../utils\");\nconst auth_provider_1 = require(\"./auth_provider\");\nclass MongoCR extends auth_provider_1.AuthProvider {\n  async auth(authContext) {\n    const {\n      connection,\n      credentials\n    } = authContext;\n    if (!credentials) {\n      throw new error_1.MongoMissingCredentialsError('AuthContext must provide credentials.');\n    }\n    const {\n      username,\n      password,\n      source\n    } = credentials;\n    const {\n      nonce\n    } = await connection.commandAsync((0, utils_1.ns)(`${source}.$cmd`), {\n      getnonce: 1\n    }, undefined);\n    const hashPassword = crypto.createHash('md5').update(`${username}:mongo:${password}`, 'utf8').digest('hex');\n    // Final key\n    const key = crypto.createHash('md5').update(`${nonce}${username}${hashPassword}`, 'utf8').digest('hex');\n    const authenticateCommand = {\n      authenticate: 1,\n      user: username,\n      nonce,\n      key\n    };\n    await connection.commandAsync((0, utils_1.ns)(`${source}.$cmd`), authenticateCommand, undefined);\n  }\n}\nexports.MongoCR = MongoCR;","map":{"version":3,"names":["crypto","require","error_1","utils_1","auth_provider_1","MongoCR","AuthProvider","auth","authContext","connection","credentials","MongoMissingCredentialsError","username","password","source","nonce","commandAsync","ns","getnonce","undefined","hashPassword","createHash","update","digest","key","authenticateCommand","authenticate","user","exports"],"sources":["C:\\Users\\raphm\\Documents\\Projects\\youtube-transcript\\youtube-transcript\\node_modules\\mongodb\\src\\cmap\\auth\\mongocr.ts"],"sourcesContent":["import * as crypto from 'crypto';\n\nimport { MongoMissingCredentialsError } from '../../error';\nimport { ns } from '../../utils';\nimport { type AuthContext, AuthProvider } from './auth_provider';\n\nexport class MongoCR extends AuthProvider {\n  override async auth(authContext: AuthContext): Promise<void> {\n    const { connection, credentials } = authContext;\n    if (!credentials) {\n      throw new MongoMissingCredentialsError('AuthContext must provide credentials.');\n    }\n\n    const { username, password, source } = credentials;\n\n    const { nonce } = await connection.commandAsync(\n      ns(`${source}.$cmd`),\n      { getnonce: 1 },\n      undefined\n    );\n\n    const hashPassword = crypto\n      .createHash('md5')\n      .update(`${username}:mongo:${password}`, 'utf8')\n      .digest('hex');\n\n    // Final key\n    const key = crypto\n      .createHash('md5')\n      .update(`${nonce}${username}${hashPassword}`, 'utf8')\n      .digest('hex');\n\n    const authenticateCommand = {\n      authenticate: 1,\n      user: username,\n      nonce,\n      key\n    };\n\n    await connection.commandAsync(ns(`${source}.$cmd`), authenticateCommand, undefined);\n  }\n}\n"],"mappings":";;;;;;AAAA,MAAAA,MAAA,GAAAC,OAAA;AAEA,MAAAC,OAAA,GAAAD,OAAA;AACA,MAAAE,OAAA,GAAAF,OAAA;AACA,MAAAG,eAAA,GAAAH,OAAA;AAEA,MAAaI,OAAQ,SAAQD,eAAA,CAAAE,YAAY;EAC9B,MAAMC,IAAIA,CAACC,WAAwB;IAC1C,MAAM;MAAEC,UAAU;MAAEC;IAAW,CAAE,GAAGF,WAAW;IAC/C,IAAI,CAACE,WAAW,EAAE;MAChB,MAAM,IAAIR,OAAA,CAAAS,4BAA4B,CAAC,uCAAuC,CAAC;;IAGjF,MAAM;MAAEC,QAAQ;MAAEC,QAAQ;MAAEC;IAAM,CAAE,GAAGJ,WAAW;IAElD,MAAM;MAAEK;IAAK,CAAE,GAAG,MAAMN,UAAU,CAACO,YAAY,CAC7C,IAAAb,OAAA,CAAAc,EAAE,EAAC,GAAGH,MAAM,OAAO,CAAC,EACpB;MAAEI,QAAQ,EAAE;IAAC,CAAE,EACfC,SAAS,CACV;IAED,MAAMC,YAAY,GAAGpB,MAAM,CACxBqB,UAAU,CAAC,KAAK,CAAC,CACjBC,MAAM,CAAC,GAAGV,QAAQ,UAAUC,QAAQ,EAAE,EAAE,MAAM,CAAC,CAC/CU,MAAM,CAAC,KAAK,CAAC;IAEhB;IACA,MAAMC,GAAG,GAAGxB,MAAM,CACfqB,UAAU,CAAC,KAAK,CAAC,CACjBC,MAAM,CAAC,GAAGP,KAAK,GAAGH,QAAQ,GAAGQ,YAAY,EAAE,EAAE,MAAM,CAAC,CACpDG,MAAM,CAAC,KAAK,CAAC;IAEhB,MAAME,mBAAmB,GAAG;MAC1BC,YAAY,EAAE,CAAC;MACfC,IAAI,EAAEf,QAAQ;MACdG,KAAK;MACLS;KACD;IAED,MAAMf,UAAU,CAACO,YAAY,CAAC,IAAAb,OAAA,CAAAc,EAAE,EAAC,GAAGH,MAAM,OAAO,CAAC,EAAEW,mBAAmB,EAAEN,SAAS,CAAC;EACrF;;AAlCFS,OAAA,CAAAvB,OAAA,GAAAA,OAAA"},"metadata":{},"sourceType":"script","externalDependencies":[]}