{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.MongoDBAWS = void 0;\nconst crypto = require(\"crypto\");\nconst process = require(\"process\");\nconst util_1 = require(\"util\");\nconst BSON = require(\"../../bson\");\nconst deps_1 = require(\"../../deps\");\nconst error_1 = require(\"../../error\");\nconst utils_1 = require(\"../../utils\");\nconst auth_provider_1 = require(\"./auth_provider\");\nconst mongo_credentials_1 = require(\"./mongo_credentials\");\nconst providers_1 = require(\"./providers\");\n/**\n * The following regions use the global AWS STS endpoint, sts.amazonaws.com, by default\n * https://docs.aws.amazon.com/sdkref/latest/guide/feature-sts-regionalized-endpoints.html\n */\nconst LEGACY_REGIONS = new Set(['ap-northeast-1', 'ap-south-1', 'ap-southeast-1', 'ap-southeast-2', 'aws-global', 'ca-central-1', 'eu-central-1', 'eu-north-1', 'eu-west-1', 'eu-west-2', 'eu-west-3', 'sa-east-1', 'us-east-1', 'us-east-2', 'us-west-1', 'us-west-2']);\nconst ASCII_N = 110;\nconst AWS_RELATIVE_URI = 'http://169.254.170.2';\nconst AWS_EC2_URI = 'http://169.254.169.254';\nconst AWS_EC2_PATH = '/latest/meta-data/iam/security-credentials';\nconst bsonOptions = {\n  useBigInt64: false,\n  promoteLongs: true,\n  promoteValues: true,\n  promoteBuffers: false,\n  bsonRegExp: false\n};\nclass MongoDBAWS extends auth_provider_1.AuthProvider {\n  constructor() {\n    super();\n    this.randomBytesAsync = (0, util_1.promisify)(crypto.randomBytes);\n  }\n  async auth(authContext) {\n    const {\n      connection\n    } = authContext;\n    if (!authContext.credentials) {\n      throw new error_1.MongoMissingCredentialsError('AuthContext must provide credentials.');\n    }\n    if ('kModuleError' in deps_1.aws4) {\n      throw deps_1.aws4['kModuleError'];\n    }\n    const {\n      sign\n    } = deps_1.aws4;\n    if ((0, utils_1.maxWireVersion)(connection) < 9) {\n      throw new error_1.MongoCompatibilityError('MONGODB-AWS authentication requires MongoDB version 4.4 or later');\n    }\n    if (!authContext.credentials.username) {\n      authContext.credentials = await makeTempCredentials(authContext.credentials);\n    }\n    const {\n      credentials\n    } = authContext;\n    const accessKeyId = credentials.username;\n    const secretAccessKey = credentials.password;\n    const sessionToken = credentials.mechanismProperties.AWS_SESSION_TOKEN;\n    // If all three defined, include sessionToken, else include username and pass, else no credentials\n    const awsCredentials = accessKeyId && secretAccessKey && sessionToken ? {\n      accessKeyId,\n      secretAccessKey,\n      sessionToken\n    } : accessKeyId && secretAccessKey ? {\n      accessKeyId,\n      secretAccessKey\n    } : undefined;\n    const db = credentials.source;\n    const nonce = await this.randomBytesAsync(32);\n    const saslStart = {\n      saslStart: 1,\n      mechanism: 'MONGODB-AWS',\n      payload: BSON.serialize({\n        r: nonce,\n        p: ASCII_N\n      }, bsonOptions)\n    };\n    const saslStartResponse = await connection.commandAsync((0, utils_1.ns)(`${db}.$cmd`), saslStart, undefined);\n    const serverResponse = BSON.deserialize(saslStartResponse.payload.buffer, bsonOptions);\n    const host = serverResponse.h;\n    const serverNonce = serverResponse.s.buffer;\n    if (serverNonce.length !== 64) {\n      // TODO(NODE-3483)\n      throw new error_1.MongoRuntimeError(`Invalid server nonce length ${serverNonce.length}, expected 64`);\n    }\n    if (!utils_1.ByteUtils.equals(serverNonce.subarray(0, nonce.byteLength), nonce)) {\n      // throw because the serverNonce's leading 32 bytes must equal the client nonce's 32 bytes\n      // https://github.com/mongodb/specifications/blob/875446db44aade414011731840831f38a6c668df/source/auth/auth.rst#id11\n      // TODO(NODE-3483)\n      throw new error_1.MongoRuntimeError('Server nonce does not begin with client nonce');\n    }\n    if (host.length < 1 || host.length > 255 || host.indexOf('..') !== -1) {\n      // TODO(NODE-3483)\n      throw new error_1.MongoRuntimeError(`Server returned an invalid host: \"${host}\"`);\n    }\n    const body = 'Action=GetCallerIdentity&Version=2011-06-15';\n    const options = sign({\n      method: 'POST',\n      host,\n      region: deriveRegion(serverResponse.h),\n      service: 'sts',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n        'Content-Length': body.length,\n        'X-MongoDB-Server-Nonce': utils_1.ByteUtils.toBase64(serverNonce),\n        'X-MongoDB-GS2-CB-Flag': 'n'\n      },\n      path: '/',\n      body\n    }, awsCredentials);\n    const payload = {\n      a: options.headers.Authorization,\n      d: options.headers['X-Amz-Date']\n    };\n    if (sessionToken) {\n      payload.t = sessionToken;\n    }\n    const saslContinue = {\n      saslContinue: 1,\n      conversationId: 1,\n      payload: BSON.serialize(payload, bsonOptions)\n    };\n    await connection.commandAsync((0, utils_1.ns)(`${db}.$cmd`), saslContinue, undefined);\n  }\n}\nMongoDBAWS.credentialProvider = null;\nexports.MongoDBAWS = MongoDBAWS;\nasync function makeTempCredentials(credentials) {\n  function makeMongoCredentialsFromAWSTemp(creds) {\n    if (!creds.AccessKeyId || !creds.SecretAccessKey || !creds.Token) {\n      throw new error_1.MongoMissingCredentialsError('Could not obtain temporary MONGODB-AWS credentials');\n    }\n    return new mongo_credentials_1.MongoCredentials({\n      username: creds.AccessKeyId,\n      password: creds.SecretAccessKey,\n      source: credentials.source,\n      mechanism: providers_1.AuthMechanism.MONGODB_AWS,\n      mechanismProperties: {\n        AWS_SESSION_TOKEN: creds.Token\n      }\n    });\n  }\n  MongoDBAWS.credentialProvider ??= (0, deps_1.getAwsCredentialProvider)();\n  // Check if the AWS credential provider from the SDK is present. If not,\n  // use the old method.\n  if ('kModuleError' in MongoDBAWS.credentialProvider) {\n    // If the environment variable AWS_CONTAINER_CREDENTIALS_RELATIVE_URI\n    // is set then drivers MUST assume that it was set by an AWS ECS agent\n    if (process.env.AWS_CONTAINER_CREDENTIALS_RELATIVE_URI) {\n      return makeMongoCredentialsFromAWSTemp(await (0, utils_1.request)(`${AWS_RELATIVE_URI}${process.env.AWS_CONTAINER_CREDENTIALS_RELATIVE_URI}`));\n    }\n    // Otherwise assume we are on an EC2 instance\n    // get a token\n    const token = await (0, utils_1.request)(`${AWS_EC2_URI}/latest/api/token`, {\n      method: 'PUT',\n      json: false,\n      headers: {\n        'X-aws-ec2-metadata-token-ttl-seconds': 30\n      }\n    });\n    // get role name\n    const roleName = await (0, utils_1.request)(`${AWS_EC2_URI}/${AWS_EC2_PATH}`, {\n      json: false,\n      headers: {\n        'X-aws-ec2-metadata-token': token\n      }\n    });\n    // get temp credentials\n    const creds = await (0, utils_1.request)(`${AWS_EC2_URI}/${AWS_EC2_PATH}/${roleName}`, {\n      headers: {\n        'X-aws-ec2-metadata-token': token\n      }\n    });\n    return makeMongoCredentialsFromAWSTemp(creds);\n  } else {\n    let {\n      AWS_STS_REGIONAL_ENDPOINTS = '',\n      AWS_REGION = ''\n    } = process.env;\n    AWS_STS_REGIONAL_ENDPOINTS = AWS_STS_REGIONAL_ENDPOINTS.toLowerCase();\n    AWS_REGION = AWS_REGION.toLowerCase();\n    /** The option setting should work only for users who have explicit settings in their environment, the driver should not encode \"defaults\" */\n    const awsRegionSettingsExist = AWS_REGION.length !== 0 && AWS_STS_REGIONAL_ENDPOINTS.length !== 0;\n    /**\n     * If AWS_STS_REGIONAL_ENDPOINTS is set to regional, users are opting into the new behavior of respecting the region settings\n     *\n     * If AWS_STS_REGIONAL_ENDPOINTS is set to legacy, then \"old\" regions need to keep using the global setting.\n     * Technically the SDK gets this wrong, it reaches out to 'sts.us-east-1.amazonaws.com' when it should be 'sts.amazonaws.com'.\n     * That is not our bug to fix here. We leave that up to the SDK.\n     */\n    const useRegionalSts = AWS_STS_REGIONAL_ENDPOINTS === 'regional' || AWS_STS_REGIONAL_ENDPOINTS === 'legacy' && !LEGACY_REGIONS.has(AWS_REGION);\n    const provider = awsRegionSettingsExist && useRegionalSts ? MongoDBAWS.credentialProvider.fromNodeProviderChain({\n      clientConfig: {\n        region: AWS_REGION\n      }\n    }) : MongoDBAWS.credentialProvider.fromNodeProviderChain();\n    /*\n     * Creates a credential provider that will attempt to find credentials from the\n     * following sources (listed in order of precedence):\n     *\n     * - Environment variables exposed via process.env\n     * - SSO credentials from token cache\n     * - Web identity token credentials\n     * - Shared credentials and config ini files\n     * - The EC2/ECS Instance Metadata Service\n     */\n    try {\n      const creds = await provider();\n      return makeMongoCredentialsFromAWSTemp({\n        AccessKeyId: creds.accessKeyId,\n        SecretAccessKey: creds.secretAccessKey,\n        Token: creds.sessionToken,\n        Expiration: creds.expiration\n      });\n    } catch (error) {\n      throw new error_1.MongoAWSError(error.message);\n    }\n  }\n}\nfunction deriveRegion(host) {\n  const parts = host.split('.');\n  if (parts.length === 1 || parts[1] === 'amazonaws') {\n    return 'us-east-1';\n  }\n  return parts[1];\n}","map":{"version":3,"names":["crypto","require","process","util_1","BSON","deps_1","error_1","utils_1","auth_provider_1","mongo_credentials_1","providers_1","LEGACY_REGIONS","Set","ASCII_N","AWS_RELATIVE_URI","AWS_EC2_URI","AWS_EC2_PATH","bsonOptions","useBigInt64","promoteLongs","promoteValues","promoteBuffers","bsonRegExp","MongoDBAWS","AuthProvider","constructor","randomBytesAsync","promisify","randomBytes","auth","authContext","connection","credentials","MongoMissingCredentialsError","aws4","sign","maxWireVersion","MongoCompatibilityError","username","makeTempCredentials","accessKeyId","secretAccessKey","password","sessionToken","mechanismProperties","AWS_SESSION_TOKEN","awsCredentials","undefined","db","source","nonce","saslStart","mechanism","payload","serialize","r","p","saslStartResponse","commandAsync","ns","serverResponse","deserialize","buffer","host","h","serverNonce","s","length","MongoRuntimeError","ByteUtils","equals","subarray","byteLength","indexOf","body","options","method","region","deriveRegion","service","headers","toBase64","path","a","Authorization","d","t","saslContinue","conversationId","credentialProvider","exports","makeMongoCredentialsFromAWSTemp","creds","AccessKeyId","SecretAccessKey","Token","MongoCredentials","AuthMechanism","MONGODB_AWS","getAwsCredentialProvider","env","AWS_CONTAINER_CREDENTIALS_RELATIVE_URI","request","token","json","roleName","AWS_STS_REGIONAL_ENDPOINTS","AWS_REGION","toLowerCase","awsRegionSettingsExist","useRegionalSts","has","provider","fromNodeProviderChain","clientConfig","Expiration","expiration","error","MongoAWSError","message","parts","split"],"sources":["C:\\Users\\raphm\\Documents\\Projects\\youtube-transcript\\youtube-transcript\\node_modules\\mongodb\\src\\cmap\\auth\\mongodb_aws.ts"],"sourcesContent":["import * as crypto from 'crypto';\nimport * as process from 'process';\nimport { promisify } from 'util';\n\nimport type { Binary, BSONSerializeOptions } from '../../bson';\nimport * as BSON from '../../bson';\nimport { aws4, getAwsCredentialProvider } from '../../deps';\nimport {\n  MongoAWSError,\n  MongoCompatibilityError,\n  MongoMissingCredentialsError,\n  MongoRuntimeError\n} from '../../error';\nimport { ByteUtils, maxWireVersion, ns, request } from '../../utils';\nimport { type AuthContext, AuthProvider } from './auth_provider';\nimport { MongoCredentials } from './mongo_credentials';\nimport { AuthMechanism } from './providers';\n\n/**\n * The following regions use the global AWS STS endpoint, sts.amazonaws.com, by default\n * https://docs.aws.amazon.com/sdkref/latest/guide/feature-sts-regionalized-endpoints.html\n */\nconst LEGACY_REGIONS = new Set([\n  'ap-northeast-1',\n  'ap-south-1',\n  'ap-southeast-1',\n  'ap-southeast-2',\n  'aws-global',\n  'ca-central-1',\n  'eu-central-1',\n  'eu-north-1',\n  'eu-west-1',\n  'eu-west-2',\n  'eu-west-3',\n  'sa-east-1',\n  'us-east-1',\n  'us-east-2',\n  'us-west-1',\n  'us-west-2'\n]);\nconst ASCII_N = 110;\nconst AWS_RELATIVE_URI = 'http://169.254.170.2';\nconst AWS_EC2_URI = 'http://169.254.169.254';\nconst AWS_EC2_PATH = '/latest/meta-data/iam/security-credentials';\nconst bsonOptions: BSONSerializeOptions = {\n  useBigInt64: false,\n  promoteLongs: true,\n  promoteValues: true,\n  promoteBuffers: false,\n  bsonRegExp: false\n};\n\ninterface AWSSaslContinuePayload {\n  a: string;\n  d: string;\n  t?: string;\n}\n\nexport class MongoDBAWS extends AuthProvider {\n  static credentialProvider: ReturnType<typeof getAwsCredentialProvider> | null = null;\n  randomBytesAsync: (size: number) => Promise<Buffer>;\n\n  constructor() {\n    super();\n    this.randomBytesAsync = promisify(crypto.randomBytes);\n  }\n\n  override async auth(authContext: AuthContext): Promise<void> {\n    const { connection } = authContext;\n    if (!authContext.credentials) {\n      throw new MongoMissingCredentialsError('AuthContext must provide credentials.');\n    }\n\n    if ('kModuleError' in aws4) {\n      throw aws4['kModuleError'];\n    }\n    const { sign } = aws4;\n\n    if (maxWireVersion(connection) < 9) {\n      throw new MongoCompatibilityError(\n        'MONGODB-AWS authentication requires MongoDB version 4.4 or later'\n      );\n    }\n\n    if (!authContext.credentials.username) {\n      authContext.credentials = await makeTempCredentials(authContext.credentials);\n    }\n\n    const { credentials } = authContext;\n\n    const accessKeyId = credentials.username;\n    const secretAccessKey = credentials.password;\n    const sessionToken = credentials.mechanismProperties.AWS_SESSION_TOKEN;\n\n    // If all three defined, include sessionToken, else include username and pass, else no credentials\n    const awsCredentials =\n      accessKeyId && secretAccessKey && sessionToken\n        ? { accessKeyId, secretAccessKey, sessionToken }\n        : accessKeyId && secretAccessKey\n        ? { accessKeyId, secretAccessKey }\n        : undefined;\n\n    const db = credentials.source;\n    const nonce = await this.randomBytesAsync(32);\n\n    const saslStart = {\n      saslStart: 1,\n      mechanism: 'MONGODB-AWS',\n      payload: BSON.serialize({ r: nonce, p: ASCII_N }, bsonOptions)\n    };\n\n    const saslStartResponse = await connection.commandAsync(ns(`${db}.$cmd`), saslStart, undefined);\n\n    const serverResponse = BSON.deserialize(saslStartResponse.payload.buffer, bsonOptions) as {\n      s: Binary;\n      h: string;\n    };\n    const host = serverResponse.h;\n    const serverNonce = serverResponse.s.buffer;\n    if (serverNonce.length !== 64) {\n      // TODO(NODE-3483)\n      throw new MongoRuntimeError(`Invalid server nonce length ${serverNonce.length}, expected 64`);\n    }\n\n    if (!ByteUtils.equals(serverNonce.subarray(0, nonce.byteLength), nonce)) {\n      // throw because the serverNonce's leading 32 bytes must equal the client nonce's 32 bytes\n      // https://github.com/mongodb/specifications/blob/875446db44aade414011731840831f38a6c668df/source/auth/auth.rst#id11\n\n      // TODO(NODE-3483)\n      throw new MongoRuntimeError('Server nonce does not begin with client nonce');\n    }\n\n    if (host.length < 1 || host.length > 255 || host.indexOf('..') !== -1) {\n      // TODO(NODE-3483)\n      throw new MongoRuntimeError(`Server returned an invalid host: \"${host}\"`);\n    }\n\n    const body = 'Action=GetCallerIdentity&Version=2011-06-15';\n    const options = sign(\n      {\n        method: 'POST',\n        host,\n        region: deriveRegion(serverResponse.h),\n        service: 'sts',\n        headers: {\n          'Content-Type': 'application/x-www-form-urlencoded',\n          'Content-Length': body.length,\n          'X-MongoDB-Server-Nonce': ByteUtils.toBase64(serverNonce),\n          'X-MongoDB-GS2-CB-Flag': 'n'\n        },\n        path: '/',\n        body\n      },\n      awsCredentials\n    );\n\n    const payload: AWSSaslContinuePayload = {\n      a: options.headers.Authorization,\n      d: options.headers['X-Amz-Date']\n    };\n\n    if (sessionToken) {\n      payload.t = sessionToken;\n    }\n\n    const saslContinue = {\n      saslContinue: 1,\n      conversationId: 1,\n      payload: BSON.serialize(payload, bsonOptions)\n    };\n\n    await connection.commandAsync(ns(`${db}.$cmd`), saslContinue, undefined);\n  }\n}\n\ninterface AWSTempCredentials {\n  AccessKeyId?: string;\n  SecretAccessKey?: string;\n  Token?: string;\n  RoleArn?: string;\n  Expiration?: Date;\n}\n\nasync function makeTempCredentials(credentials: MongoCredentials): Promise<MongoCredentials> {\n  function makeMongoCredentialsFromAWSTemp(creds: AWSTempCredentials) {\n    if (!creds.AccessKeyId || !creds.SecretAccessKey || !creds.Token) {\n      throw new MongoMissingCredentialsError('Could not obtain temporary MONGODB-AWS credentials');\n    }\n\n    return new MongoCredentials({\n      username: creds.AccessKeyId,\n      password: creds.SecretAccessKey,\n      source: credentials.source,\n      mechanism: AuthMechanism.MONGODB_AWS,\n      mechanismProperties: {\n        AWS_SESSION_TOKEN: creds.Token\n      }\n    });\n  }\n\n  MongoDBAWS.credentialProvider ??= getAwsCredentialProvider();\n\n  // Check if the AWS credential provider from the SDK is present. If not,\n  // use the old method.\n  if ('kModuleError' in MongoDBAWS.credentialProvider) {\n    // If the environment variable AWS_CONTAINER_CREDENTIALS_RELATIVE_URI\n    // is set then drivers MUST assume that it was set by an AWS ECS agent\n    if (process.env.AWS_CONTAINER_CREDENTIALS_RELATIVE_URI) {\n      return makeMongoCredentialsFromAWSTemp(\n        await request(`${AWS_RELATIVE_URI}${process.env.AWS_CONTAINER_CREDENTIALS_RELATIVE_URI}`)\n      );\n    }\n\n    // Otherwise assume we are on an EC2 instance\n\n    // get a token\n    const token = await request(`${AWS_EC2_URI}/latest/api/token`, {\n      method: 'PUT',\n      json: false,\n      headers: { 'X-aws-ec2-metadata-token-ttl-seconds': 30 }\n    });\n\n    // get role name\n    const roleName = await request(`${AWS_EC2_URI}/${AWS_EC2_PATH}`, {\n      json: false,\n      headers: { 'X-aws-ec2-metadata-token': token }\n    });\n\n    // get temp credentials\n    const creds = await request(`${AWS_EC2_URI}/${AWS_EC2_PATH}/${roleName}`, {\n      headers: { 'X-aws-ec2-metadata-token': token }\n    });\n\n    return makeMongoCredentialsFromAWSTemp(creds);\n  } else {\n    let { AWS_STS_REGIONAL_ENDPOINTS = '', AWS_REGION = '' } = process.env;\n    AWS_STS_REGIONAL_ENDPOINTS = AWS_STS_REGIONAL_ENDPOINTS.toLowerCase();\n    AWS_REGION = AWS_REGION.toLowerCase();\n\n    /** The option setting should work only for users who have explicit settings in their environment, the driver should not encode \"defaults\" */\n    const awsRegionSettingsExist =\n      AWS_REGION.length !== 0 && AWS_STS_REGIONAL_ENDPOINTS.length !== 0;\n\n    /**\n     * If AWS_STS_REGIONAL_ENDPOINTS is set to regional, users are opting into the new behavior of respecting the region settings\n     *\n     * If AWS_STS_REGIONAL_ENDPOINTS is set to legacy, then \"old\" regions need to keep using the global setting.\n     * Technically the SDK gets this wrong, it reaches out to 'sts.us-east-1.amazonaws.com' when it should be 'sts.amazonaws.com'.\n     * That is not our bug to fix here. We leave that up to the SDK.\n     */\n    const useRegionalSts =\n      AWS_STS_REGIONAL_ENDPOINTS === 'regional' ||\n      (AWS_STS_REGIONAL_ENDPOINTS === 'legacy' && !LEGACY_REGIONS.has(AWS_REGION));\n\n    const provider =\n      awsRegionSettingsExist && useRegionalSts\n        ? MongoDBAWS.credentialProvider.fromNodeProviderChain({\n            clientConfig: { region: AWS_REGION }\n          })\n        : MongoDBAWS.credentialProvider.fromNodeProviderChain();\n\n    /*\n     * Creates a credential provider that will attempt to find credentials from the\n     * following sources (listed in order of precedence):\n     *\n     * - Environment variables exposed via process.env\n     * - SSO credentials from token cache\n     * - Web identity token credentials\n     * - Shared credentials and config ini files\n     * - The EC2/ECS Instance Metadata Service\n     */\n    try {\n      const creds = await provider();\n      return makeMongoCredentialsFromAWSTemp({\n        AccessKeyId: creds.accessKeyId,\n        SecretAccessKey: creds.secretAccessKey,\n        Token: creds.sessionToken,\n        Expiration: creds.expiration\n      });\n    } catch (error) {\n      throw new MongoAWSError(error.message);\n    }\n  }\n}\n\nfunction deriveRegion(host: string) {\n  const parts = host.split('.');\n  if (parts.length === 1 || parts[1] === 'amazonaws') {\n    return 'us-east-1';\n  }\n\n  return parts[1];\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}