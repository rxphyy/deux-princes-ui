{"ast":null,"code":"\"use strict\";\n\nconst memory_code_points_1 = require(\"./memory-code-points\");\nconst mapping2space = memory_code_points_1.non_ASCII_space_characters;\nconst mapping2nothing = memory_code_points_1.commonly_mapped_to_nothing;\nconst getCodePoint = character => character.codePointAt(0);\nconst first = x => x[0];\nconst last = x => x[x.length - 1];\nfunction toCodePoints(input) {\n  const codepoints = [];\n  const size = input.length;\n  for (let i = 0; i < size; i += 1) {\n    const before = input.charCodeAt(i);\n    if (before >= 0xd800 && before <= 0xdbff && size > i + 1) {\n      const next = input.charCodeAt(i + 1);\n      if (next >= 0xdc00 && next <= 0xdfff) {\n        codepoints.push((before - 0xd800) * 0x400 + next - 0xdc00 + 0x10000);\n        i += 1;\n        continue;\n      }\n    }\n    codepoints.push(before);\n  }\n  return codepoints;\n}\nfunction saslprep(input, opts = {}) {\n  if (typeof input !== 'string') {\n    throw new TypeError('Expected string.');\n  }\n  if (input.length === 0) {\n    return '';\n  }\n  const mapped_input = toCodePoints(input).map(character => mapping2space.get(character) ? 0x20 : character).filter(character => !mapping2nothing.get(character));\n  const normalized_input = String.fromCodePoint.apply(null, mapped_input).normalize('NFKC');\n  const normalized_map = toCodePoints(normalized_input);\n  const hasProhibited = normalized_map.some(character => memory_code_points_1.prohibited_characters.get(character));\n  if (hasProhibited) {\n    throw new Error('Prohibited character, see https://tools.ietf.org/html/rfc4013#section-2.3');\n  }\n  if (opts.allowUnassigned !== true) {\n    const hasUnassigned = normalized_map.some(character => memory_code_points_1.unassigned_code_points.get(character));\n    if (hasUnassigned) {\n      throw new Error('Unassigned code point, see https://tools.ietf.org/html/rfc4013#section-2.5');\n    }\n  }\n  const hasBidiRAL = normalized_map.some(character => memory_code_points_1.bidirectional_r_al.get(character));\n  const hasBidiL = normalized_map.some(character => memory_code_points_1.bidirectional_l.get(character));\n  if (hasBidiRAL && hasBidiL) {\n    throw new Error('String must not contain RandALCat and LCat at the same time,' + ' see https://tools.ietf.org/html/rfc3454#section-6');\n  }\n  const isFirstBidiRAL = memory_code_points_1.bidirectional_r_al.get(getCodePoint(first(normalized_input)));\n  const isLastBidiRAL = memory_code_points_1.bidirectional_r_al.get(getCodePoint(last(normalized_input)));\n  if (hasBidiRAL && !(isFirstBidiRAL && isLastBidiRAL)) {\n    throw new Error('Bidirectional RandALCat character must be the first and the last' + ' character of the string, see https://tools.ietf.org/html/rfc3454#section-6');\n  }\n  return normalized_input;\n}\nsaslprep.saslprep = saslprep;\nsaslprep.default = saslprep;\nmodule.exports = saslprep;","map":{"version":3,"names":["memory_code_points_1","require","mapping2space","non_ASCII_space_characters","mapping2nothing","commonly_mapped_to_nothing","getCodePoint","character","codePointAt","first","x","last","length","toCodePoints","input","codepoints","size","i","before","charCodeAt","next","push","saslprep","opts","TypeError","mapped_input","map","get","filter","normalized_input","String","fromCodePoint","apply","normalize","normalized_map","hasProhibited","some","prohibited_characters","Error","allowUnassigned","hasUnassigned","unassigned_code_points","hasBidiRAL","bidirectional_r_al","hasBidiL","bidirectional_l","isFirstBidiRAL","isLastBidiRAL","default","module","exports"],"sources":["../src/index.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}